# 云文件管理系统 - 开发记录

## 项目概述
基于 Spring Boot + Vue3 + Element Plus 的云文件管理系统

## 技术栈
- **后端**: Spring Boot 2.x + MyBatis-Plus + MySQL + Redis
- **前端**: Vue3 + Vite + Element Plus + TypeScript
- **部署**: Docker + Docker Compose + Nginx

---

## 重要修改记录

### 1. 文件预览服务集成
**问题**: 原系统需要单独启动 8918 端口的静态文件服务器  
**解决**: 将静态文件服务集成到 Spring Boot 后端

**新增文件**:
- `FilePreviewController.java` - 文件预览控制器，处理 `/files/**`、`/thum/**`、`/trans/**`

**修改文件**:
- `application.yml` - `preview-url` 从 8918 改为 8919
- `WebConfig.java` - 排除文件预览路径的 Token 验证

---

### 2. 存储空间统计修复
**问题**: 回收站操作后存储空间统计不刷新  
**原因**: `trash.vue` 没有触发 `file-changed` 事件

**修改文件**:
- `trash.vue` - 在删除和还原操作后添加 `eventBus.emit('file-changed')`

---

### 3. 回收站清空功能
**新增功能**: 一键清空回收站

**后端**:
- `TrashController.java` - 新增 `/trash/clear` 接口
- `FileTrashService.java` - 新增 `clearAll()` 方法

**前端**:
- `trash.vue` - 添加"清空回收站"按钮和确认对话框

---

### 4. 用户认证系统
**新增功能**: 用户注册、登录、JWT 认证

**后端**:
- `UserController.java` - 登录/注册接口
- `UserService.java` - 用户服务
- `GlobalInterceptor.java` - Token 拦截器
- `JwtConfig.java` - JWT 配置

**前端**:
- `Login.vue` - 登录/注册页面

---

### 5. 文件分享功能
**新增功能**: 文件分享链接（支持密码、有效期）

**后端**:
- `ShareController.java` - 分享接口
- `FileShareService.java` - 分享服务
- `FileShare.java` - 分享实体

**前端**:
- `ShareAccess.vue` - 分享访问页面

---

## 容器化部署

### 架构
```
Nginx (:80) → 前端静态文件
           → /api/* → Backend (:8919) → MySQL (:3306)
                                      → Redis (:6379)
```

### 文件说明
- `docker-compose.yml` - 服务编排
- `deploy.sh` - 一键部署脚本
- `nginx/nginx.conf` - Nginx 配置
- `project/backend/Dockerfile` - 后端镜像（多阶段构建）
- `project/frontend/Dockerfile` - 前端镜像

### 部署命令
```bash
chmod +x deploy.sh
./deploy.sh          # 启动
./deploy.sh stop     # 停止
./deploy.sh logs     # 日志
./deploy.sh clean    # 清理
```

---

## 数据库

### 初始化脚本
- `sql/00-init-all.sql` - 完整初始化脚本
- `sql/lfs.sql` - 主表结构
- `sql/sys_user.sql` - 用户表

### 默认账号
- 用户名: `admin`
- 密码: `123456`

---

## 本地开发

### 后端启动
```bash
cd project/backend
mvn spring-boot:run
# 访问 http://localhost:8919
```

### 前端启动
```bash
cd project/frontend
npm install
npm run dev
# 访问 http://localhost:5173
```

### 依赖服务
- MySQL 5.7+ (端口 3306)
- Redis 6+ (端口 6379)

---

## 配置说明

### application.yml 关键配置
```yaml
server:
  port: 8919

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/lfs
    username: root
    password: 123456

file-server:
  local:
    file-dir: /Users/rexan/lfs/uploadFile  # 文件存储路径
    preview-url: http://127.0.0.1:8919     # 预览地址
```

---

## Git 仓库
- 地址: https://github.com/RexaNax/-
- 分支: main
